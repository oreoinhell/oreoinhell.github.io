<div id="meteor-trigger" class="meteor-fab" title="æ‰“å¼€æµæ˜Ÿé›¨è§‚æµ‹ç«™">
    <span class="fab-icon">ðŸ”­</span>
</div>

<div id="meteor-panel" class="meteor-popup">
    <div class="meteor-header">
        <h4>ðŸŒ  <span id="meteor-year"></span> è§‚æµ‹è¡¨</h4>
        <span class="close-meteor">Ã—</span>
    </div>
    
    <div class="meteor-list-scroll">
        {{ range .Site.Data.meteors }}
        <div class="meteor-item-small" data-date="{{ .date }}">
            <div class="meteor-icon">{{ .icon }}</div>
            <div class="meteor-info">
                <div class="meteor-name">{{ .name }}</div>
                <div class="meteor-date">{{ .date }}</div>
            </div>
            <div class="meteor-status"></div>
        </div>
        {{ end }}
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const trigger = document.getElementById('meteor-trigger');
    const panel = document.getElementById('meteor-panel');
    const closeBtn = document.querySelector('.close-meteor');
    const yearSpan = document.getElementById('meteor-year'); // èŽ·å–å¹´ä»½å®¹å™¨
    
    // --- é¢æ¿å¼€å…³é€»è¾‘ ---
    trigger.addEventListener('click', function(e) {
        e.stopPropagation();
        panel.classList.toggle('show');
        trigger.classList.toggle('active');
    });
    closeBtn.addEventListener('click', function() {
        panel.classList.remove('show');
        trigger.classList.remove('active');
    });
    document.addEventListener('click', function(e) {
        if (!panel.contains(e.target) && !trigger.contains(e.target)) {
            panel.classList.remove('show');
            trigger.classList.remove('active');
        }
    });

    // --- é«˜äº®ä¸Žå¹´ä»½åˆ¤æ–­é€»è¾‘ ---
    const items = document.querySelectorAll('.meteor-item-small');
    const today = new Date();
    const currentYear = today.getFullYear(); // èŽ·å–ä»Šå¹´å¹´ä»½ (ä¾‹å¦‚ 2025)
    const currentMonth = today.getMonth() + 1;
    const currentDay = today.getDate();
    
    let foundNext = false;

    items.forEach(item => {
        const dateStr = item.getAttribute('data-date').split(' - ')[0]; 
        const [m, d] = dateStr.split('.').map(Number);
        
        if (!foundNext) {
            // å¯»æ‰¾ä»Šå¹´è¿˜æ²¡è¿‡çš„æµæ˜Ÿé›¨
            if (m > currentMonth || (m === currentMonth && d >= currentDay)) {
                item.classList.add('next-event');
                item.querySelector('.meteor-status').innerHTML = '<span class="dot-next"></span>';
                foundNext = true; 
            }
        }
    });
    
    // ðŸ‘‡ æ ¸å¿ƒä¿®æ”¹åœ¨è¿™é‡Œ
    if (foundNext) {
        // æƒ…å†µ Aï¼šä»Šå¹´è¿˜æœ‰æµæ˜Ÿé›¨ -> æ˜¾ç¤ºä»Šå¹´
        yearSpan.innerText = currentYear;
    } else {
        // æƒ…å†µ Bï¼šä»Šå¹´çš„éƒ½è¿‡å®Œäº† -> æ˜¾ç¤ºæ˜Žå¹´
        yearSpan.innerText = currentYear + 1;
        
        // å¹¶ä¸”é«˜äº®åˆ—è¡¨é‡Œçš„ç¬¬ä¸€ä¸ªï¼ˆæ˜Žå¹´çš„ç¬¬ä¸€åœºï¼‰
        if (items.length > 0) {
            items[0].classList.add('next-event');
            items[0].querySelector('.meteor-status').innerHTML = '<span class="dot-next"></span>';
        }
    }
});
</script>